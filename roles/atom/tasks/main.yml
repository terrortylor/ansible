---
# tasks file for atom
- name: Install atom packages using apm
  remote_user: atom.install_user
  shell: >
    apm list --bare | grep -E '^{{ item }}@'
    && echo 'Already installed.'
    || apm install '{{ item }}'
  loop: "{{ atom.packages }}"
  register: apm_result
  changed_when: "'Already installed.' not in apm_result.stdout"

- set_fact: home_dir="/home"
  when: ansible_facts['os_family'] == "Debian"

- set_fact: home_dir="/Users"
  when: ansible_facts['os_family'] == "Darwin"

- name: Ensure ~/.atom directory exists
  file:
    path: "{{ home_dir }}/{{ terminal.install_user }}/.atom"
    state: directory

- name: Create atom config file
  copy:
    src: files/config.cson
    dest: "{{ home_dir }}/{{ terminal.install_user }}/.atom/config.cson"
    mode: 0644
